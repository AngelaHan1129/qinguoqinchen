// src/routes/pentest.routes.js
const ErrorHandler = require('../utils/errorHandler');
const Logger = require('../utils/logger');

class PentestRoutes {
    static register(app, services) {
        const { pentestOrchestrator } = services;

        // ═══════════════════════════════════════════
        // 核心端點：執行完整滲透測試
        // ═══════════════════════════════════════════
        app.post('/pentest/execute/full', ErrorHandler.asyncHandler(async (req, res) => {
            Logger.info('🎯 接收完整滲透測試請求');

            const {
                vectorIds,
                intensity,
                targetUrl,
                generateReports = true
            } = req.body;

            // 執行完整流程
            const result = await pentestOrchestrator.executeFullPenetrationTest({
                vectorIds,
                intensity,
                targetUrl,
                generateReports
            });

            res.json(result);
        }));

        Logger.success('✅ Pentest 路由註冊完成');
    }
}

module.exports = PentestRoutes;
